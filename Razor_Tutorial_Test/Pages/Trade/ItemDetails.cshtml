@page
@model Razor_Tutorial_Test.Pages.Trade.ItemDetailsModel
@{
    ViewData["Title"] = "Order Details";
    var order = Model.OrderDetails;
}
<section class="page-section bg-dark text-primary">

    <div class="container bg-secondary text-white p-5 border border-primary rounded-5 mt-5">
        <h2 class="text-primary text-center">Order Details</h2>
        <div class="row">
            <div class="col-md-6 border border-primary rounded-5 mt-4 mb-4">
                <h4 class="mt-4 mb-4">Buyer</h4>
                <div class="d-flex align-items-center mt-2">
                    <img src="@(string.IsNullOrEmpty(order.BuyerProfilePictureUrl) ? "/images/default-profile.png" : order.BuyerProfilePictureUrl)" class="rounded-circle border border-primary me-2" style="width: 40px; height: 40px;" />
                    <span>@order.BuyerUsername</span>
                </div>

                @if (order.BuyerItemImages.Count > 0)
                {
                    <div id="buyerCarousel" class="carousel slide mt-4 mb-4" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            @for (int i = 0; i < order.BuyerItemImages.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@order.BuyerItemImages[i].ImageUrl"
                                         class="d-block w-50 h-50 mx-auto border border-primary"
                                         style="border-radius: 10px;"
                                         alt="Buyer Image" />
                                </div>
                            }
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#buyerCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#buyerCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>
                }
                else
                {
                    <div class="text-center mt-4 mb-4">
                        <img src="/itemimages/no-image.png"
                             class="d-block w-50 h-50 mx-auto border border-primary"
                             style="border-radius: 10px;"
                             alt="No Image Available" />
                        <p class="text-warning mt-2">This item does not have any images</p>
                    </div>
                }
                <div class="d-flex justify-content-center">
                    <div class="card bg-secondary text-white mb-3 border-primary rounded-4" style="max-width: 600px; width: 100%;">
                        <div class="card-body">
                            <h5 class="card-title text-primary text-center">Item Details</h5>
                            <p><strong>Item Name:</strong> @order.OfferedItemName</p>
                            <p><strong>Description:</strong></p>
                            <div class="bg-dark p-3 rounded-3 mb-2 border border-light">
                                @order.OfferedItemDescription
                            </div>
                            <p><strong>Category:</strong> @order.OfferedItemCategory</p>
                            <p><strong>Ideal Price:</strong> <span class="text-success fw-bold">RM @order.OfferedItemPrice</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 border border-primary rounded-5 mt-4 mb-4">
                <h4 class="mt-4 mb-4">Seller</h4>
                <div class="d-flex align-items-center mt-2">
                    <img src="@(string.IsNullOrEmpty(order.SellerProfilePictureUrl) ? "/images/default-profile.png" : order.SellerProfilePictureUrl)" class="rounded-circle border border-primary me-2" style="width: 40px; height: 40px;" />
                    <span>@order.SellerUsername</span>
                </div>

                @if (order.SellerItemImages.Count > 0)
                {
                    <div id="sellerCarousel" class="carousel slide mt-4 mb-4" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            @for (int i = 0; i < order.SellerItemImages.Count; i++)
                            {
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@order.SellerItemImages[i].ImageUrl"
                                         class="d-block w-50 h-50 mx-auto border border-primary"
                                         style="border-radius: 10px;"
                                         alt="Seller Image" />
                                </div>
                            }
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#sellerCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#sellerCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>
                }
                else
                {
                    <div class="text-center mt-4 mb-4">
                        <img src="/itemimages/no-image.png"
                             class="d-block w-50 h-50 mx-auto border border-primary"
                             style="border-radius: 10px;"
                             alt="No Image Available" />
                        <p class="text-warning mt-2">This item does not have any images</p>
                    </div>
                }
                <div class="d-flex justify-content-center">
                    <div class="card bg-secondary text-white mb-3 border-primary rounded-4" style="max-width: 600px; width: 100%;">
                        <div class="card-body">
                            <h5 class="card-title text-primary text-center">Item Details</h5>
                            <p><strong>Item Name:</strong> @order.RequestedItemName</p>
                            <p><strong>Description:</strong></p>
                            <div class="bg-dark p-3 rounded-3 mb-2 border border-light">
                                @order.RequestedItemDescription
                            </div>
                            <p><strong>Category:</strong> @order.RequestedItemCategory</p>
                            <p><strong>Ideal Price:</strong> <span class="text-success fw-bold">RM @order.RequestedItemPrice</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="d-flex justify-content-center">
            <div class="text-center bg-secondary text-white p-4 rounded-4 border border-primary" style="max-width: 500px; width: 100%;">
                <h4><strong>Money Offered:</strong> <span class="text-success fw-semibold">@order.MoneyOffered</span></h4>
                <h4>
                    <strong>Status:</strong>
                    <span class="fw-semibold @(
                        order.OrderStatus == "Traded" ? "text-success" :
                        order.OrderStatus == "Pending" ? "text-warning" : "text-white"
                    )">@order.OrderStatus</span>
                </h4>


                <span class="text-muted">@order.CreatedAt.ToString("dd/MM/yyyy")</span>

            </div>

        </div>
        <div class="chat-box position-fixed bottom-0 end-0 p-3">
            @if (order.CurrentUserId == order.BuyerUserID)
            {
                <div class="card border-primary bg-dark text-white" style="max-width: 300px;">
                    <div class="card-body text-center">
                        <h5 class="card-title">Need Help or Want to Negotiate?</h5>
                        <a class="btn btn-outline-info btn-sm mt-2 w-100" asp-page="/Chat/Index" asp-route-receiverId="@order.SellerUserID">
                            <i class="bi bi-chat-dots-fill"></i> Start Chat With Seller
                        </a>
                    </div>
                </div>
            }
            else if (order.CurrentUserId == order.SellerUserID)
            {
                <div class="card border-primary bg-dark text-white" style="max-width: 300px;">
                    <div class="card-body text-center">
                        <h5 class="card-title">Need Help or Want to Negotiate?</h5>
                        <a class="btn btn-outline-info btn-sm mt-2 w-100" asp-page="/Chat/Index" asp-route-receiverId="@order.BuyerUserID">
                            <i class="bi bi-chat-dots-fill"></i> Start Chat With Buyer
                        </a>
                    </div>
                </div>
            }
        </div>

        <div class="d-flex justify-content-center mt-4 mb-4">
            @if (order.OrderStatus != "Traded")
            {
                @if (order.CurrentUserId == order.SellerUserID)
                {
                    <form method="post" asp-page-handler="AcceptOffer" asp-route-orderID="@Model.OrderDetails.Id" class="me-2">
                        <button type="submit" class="btn btn-success" style="width:150px;">Accept Order</button>
                    </form>
                }
                <form method="post" asp-page-handler="CancelOrder" asp-route-id="@Model.OrderDetails.Id" asp-route-from="@Model.From" class="me-2">
                    <button type="submit" class="btn btn-danger" style="width:150px;">Cancel Order</button>
                </form>
            }
            else
            {
                <div class="text-center w-100">
                    <a asp-page="/Trade/@Model.From" class="btn btn-dark mx-auto" style="width:150px;">Back to List</a>
                </div>
            }
        </div>

        @if (order.OrderStatus != "Traded")
        {
            <div class="text-center mt-3">
                <a asp-page="/Trade/@Model.From" class="btn btn-dark mx-auto" style="width:150px;">Back to List</a>
            </div>
        }
    </div>
</section>
@section Scripts {
    <partial name="_ValidationScriptsPartial.cshtml" />
}